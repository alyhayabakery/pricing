<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>نظام طلبات الكيك - اليحي</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- خط تاجوال -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- ملف التنسيق -->
    <link rel="stylesheet" href="style.css">

    <!-- EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script>
        emailjs.init("1wFX-anJHxr-LM6Bh");
    </script>

    <!-- jsPDF لتحويل الصورة إلى PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>

<!-- شاشة تسجيل الدخول -->
<div id="loginOverlay" class="login-overlay">
    <div class="login-card">
        <div class="login-title">تسجيل الدخول</div>
        <div class="login-subtitle">أدخل كلمة المرور لتحديد الفرع</div>

        <input id="passwordInput" class="login-input" type="password" maxlength="4">
        <div id="loginError" class="login-error"></div>

        <button id="loginBtn" class="btn btn-primary login-btn">دخول</button>
    </div>
</div>

<!-- التطبيق -->
<div id="app" class="page" style="display:none;">

    <header>
        <div class="brand">نظام طلبات الكيك - اليحي</div>
        <div class="subtitle">إدارة الطلبات - الفروع</div>
    </header>

    <!-- بيانات العميل -->
    <section class="card">
        <div class="card-title">بيانات العميل</div>

        <div class="row">
            <div class="col-6">
                <label>اسم العميل</label>
                <input id="clientName" type="text">
            </div>

            <div class="col-6">
                <label>رقم الجوال</label>
                <input id="clientPhone" type="text">
            </div>
        </div>
    </section>

    <!-- تفاصيل الطلب -->
    <section class="card">
        <div class="card-title">تفاصيل الطلب</div>

        <div class="row">
            <div class="col-6">
                <label>اسم الكيك</label>
                <input id="cakeName" type="text">
            </div>

            <div class="col-6">
                <label>عدد الحصص</label>
                <input id="cakeServings" type="number" min="1">
            </div>
        </div>

        <div class="row" style="margin-top:10px;">
            <div class="col-6">
                <label>شكل الكيك</label>
                <select id="cakeShape">
                    <option value="round">دائري</option>
                    <option value="rect">مستطيل</option>
                </select>
            </div>
        </div>
                <!-- موعد الاستلام -->
        <div class="row" style="margin-top:10px;">
            <div class="col-3">
                <label>تاريخ الاستلام</label>
                <input id="pickupDate" type="date">
            </div>

            <div class="col-3">
                <label>وقت الاستلام</label>
                <input id="pickupTime" type="time">
            </div>
        </div>

        <!-- رفع صورة للطباعة -->
        <div class="row" style="margin-top:15px;">
            <div class="col-6">
                <label>صورة للطباعة (اختياري)</label>
                <input id="printImage" type="file" accept="image/*">
            </div>
        </div>

        <div id="previewImageBox" style="margin-top:10px; display:none;">
            <label>معاينة الصورة:</label>
            <img id="previewImage" src="" style="max-width:200px; border-radius:8px; border:1px solid #ddd;">
        </div>

        <!-- المقاسات الدائرية -->
        <div id="roundSizes" style="margin-top:15px;">
            <label>اختر المقاس (دائري)</label>
            <select id="cakeSize">
                <option value="15">15 سم — 60 ﷼</option>
                <option value="20">20 سم — 80 ﷼</option>
                <option value="25">25 سم — 110 ﷼</option>
                <option value="custom">مخصص (6 ﷼ لكل سم)</option>
            </select>

            <div id="customHeightBox" style="display:none; margin-top:10px;">
                <label>ارتفاع الكيك (سم)</label>
                <input id="customHeight" type="number" min="5" max="40" value="10">
            </div>
        </div>

        <!-- المقاسات المستطيلة -->
        <div id="rectSizes" style="display:none; margin-top:15px;">
            <label>اختر المقاس (مستطيل)</label>
            <select id="rectSize">
                <option value="30x40">30 × 40 — 230 ﷼</option>
                <option value="60x40">60 × 40 — 345 ﷼</option>
            </select>
        </div>
    </section>

    <!-- الحشوات -->
    <section class="card">
        <div class="card-title">الحشوات (Fillings)</div>

        <table id="fillingsTable">
            <thead>
                <tr>
                    <th>الحشوة</th>
                    <th>الكمية</th>
                    <th>السعر</th>
                    <th>الإجمالي</th>
                    <th>حذف</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <button class="btn btn-ghost btn-sm" id="addFillingBtn">+ إضافة حشوة</button>
    </section>

    <!-- الإضافات -->
    <section class="card">
        <div class="card-title">الإضافات والإكسسوارات</div>

        <table id="addonsTable">
            <thead>
                <tr>
                    <th>الصنف</th>
                    <th>الكمية</th>
                    <th>السعر</th>
                    <th>الإجمالي</th>
                    <th>حذف</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <button class="btn btn-ghost btn-sm" id="addAddonBtn">+ إضافة صنف</button>
    </section>
        <!-- التشغيل والربح -->
    <section class="card">
        <div class="card-title">التشغيل والربح</div>

        <div class="row">
            <div class="col-4">
                <label>نسبة التشغيل %</label>
                <input id="overheadPercent" type="number" value="30">
            </div>

            <div class="col-4">
                <label>نسبة الربح %</label>
                <input id="profitPercent" type="number" value="60">
            </div>

            <div class="col-4">
                <label>زيادة مستعجل %</label>
                <input id="rushPercent" type="number" value="0">
            </div>
        </div>
    </section>

    <!-- النتائج -->
    <section class="card">
        <button class="btn btn-primary" id="calculateBtn">احسب السعر</button>

        <div id="resultsSection" style="display:none; margin-top:15px;">
            <div class="results-grid">
                <div class="result-box"><div class="result-label">الحشوات</div><div id="fillingsTotal"></div></div>
                <div class="result-box"><div class="result-label">الإضافات</div><div id="addonsTotal"></div></div>
                <div class="result-box"><div class="result-label">التشغيل</div><div id="overheadValue"></div></div>
                <div class="result-box"><div class="result-label">الربح</div><div id="profitValue"></div></div>
                <div class="result-box"><div class="result-label">المستعجل</div><div id="rushValue"></div></div>
                <div class="result-box"><div class="result-label">قبل الضريبة</div><div id="beforeVat"></div></div>
                <div class="result-box"><div class="result-label">الضريبة</div><div id="vatValue"></div></div>
                <div class="result-box"><div class="result-label">بعد الضريبة</div><div id="afterVat"></div></div>
            </div>

            <button class="btn btn-success" id="exportExcelBtn">تصدير Excel</button>
            <button class="btn btn-ghost" id="whatsAppBtn">واتساب العميل</button>
            <button class="btn btn-primary" id="whatsAppProductionBtn">واتساب الإنتاج</button>
            <button class="btn btn-primary" id="sendEmailBtn">إرسال عبر الإيميل</button>
            <button class="btn btn-ghost" id="printInvoiceBtn">طباعة الطلب</button>
        </div>
    </section>

    <!-- الطلبات السابقة -->
    <section class="card">
        <div class="card-title">الطلبات السابقة</div>

        <table id="ordersTable">
            <thead>
                <tr>
                    <th>التاريخ</th>
                    <th>رقم الطلب</th>
                    <th>باتش الطلب</th>
                    <th>العميل</th>
                    <th>الهاتف</th>
                    <th>الطلب</th>
                    <th>السعر</th>
                    <th>عرض</th>
                    <th>حذف</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </section>
    </div> <!-- نهاية صفحة التطبيق -->

<!-- ملف السكربت -->
<script src="script.js"></script>

</body>
</html>
